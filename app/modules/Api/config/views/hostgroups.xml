<?xml version="1.0" encoding="UTF-8"?>
<ae:configurations xmlns:view="http://icinga.org/icinga/config/global/api/views/1.0"
    xmlns:ae="http://agavi.org/agavi/config/global/envelope/1.0"
>
    <ae:configuration>


        <dql name="TARGET_HOSTGROUP_SUMMARY" >
            <query>
                <![CDATA[
                SELECT
                    o.name1 AS hostgroup_name,
                    hg.alias AS hostgroup_alias,
                    hg.hostgroup_id AS hostgroup_id,
                    i.instance_id AS instance_id,
                    i.instance_name AS instance_name,
                    COUNT(hs.current_state) AS host_status_count,
                    hs.current_state AS host_current_state,
                    hs.current_state AS host_status,
                    hs.has_been_checked as host_has_been_checked
                FROM IcingaHostgroups hg
                INNER JOIN hg.instance i
                INNER JOIN hg.object o
                INNER JOIN hg.members hgm
                INNER JOIN hgm.status hs
                INNER JOIN hs.host h

                GROUP BY  hs.current_state, o.name1,
                    hg.alias, hg.hostgroup_id, i.instance_id, i.instance_name,
                    hs.has_been_checked
                
                WHERE hg.config_type = '${retained_flag}'
                ]]>

           </query>
           
           <credential name="UserObjectId" type="UserObjectId">
                <parameter name="target_fields">h.host_object_id</parameter>
                <parameter name="aggregation">or</parameter>
            </credential>
        </dql>

    </ae:configuration>
</ae:configurations>
