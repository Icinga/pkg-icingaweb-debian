<?xml version="1.0" encoding="UTF-8"?>
<ae:configurations xmlns:view="http://icinga.org/icinga/config/global/api/views/1.0"
    xmlns:ae="http://agavi.org/agavi/config/global/envelope/1.0"
>
    <ae:configuration>
        <dql name="TARGET_NOTIFICATIONS" >
            <query>
            <![CDATA[
            SELECT
            n.notification_id AS NOTIFICATION_ID,
            n.notification_type AS NOTIFICATION_TYPE,
            c.name1 AS NOTIFICATION_CONTACT,
            o.name1 AS HOST_NAME,
            o.name2 AS SERVICE_NAME,
            n.state AS NOTIFICATION_STATE,
            n.start_time  AS NOTIFICATION_STARTTIME,
            n.output AS NOTIFICATION_OUTPUT,
            cnc.command_line as COMMAND_NAME
            FROM IcingaNotifications n
            INNER JOIN n.object o
            LEFT JOIN n.contactnotifications cn
            LEFT JOIN cn.notificationmethod cnm
            LEFT JOIN cnm.command cnc

            LEFT JOIN cn.contactobject c
            ORDER BY notification_id DESC
            ]]>
            </query>

            <credential name="UserObjectId" type="UserObjectId">
                <parameter name="target_fields">o.object_id</parameter>
                <parameter name="aggregation">or</parameter>
            </credential>
            
            <credential name="IcingaHostCustomVariablePair" type="NotificationCustomVariable" >
                <parameter name="alias">o</parameter>
                
            </credential>
            <credential name="IcingaServiceCustomVariablePair" type="NotificationCustomVariable" >
                <parameter name="alias">o</parameter>
            </credential>



        </dql>
    </ae:configuration>
</ae:configurations>